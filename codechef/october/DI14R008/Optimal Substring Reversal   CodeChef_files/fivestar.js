(function(e){var t=function(t){var r=a(t),i=e(".star",r),l=e(".cancel",r),v=e(".fivestar-summary",t),n=0,f=v.html(),o=t.is(".fivestar-labels-hover"),u=e("select",t).val(),c=e("label",t).html(),d=c!=Drupal.settings.fivestar.titleAverage?c:Drupal.settings.fivestar.titleUser,m=false;if(t.is(".fivestar-user-stars")){var p="user"}else if(t.is(".fivestar-average-stars")){var p="average";u=e("input[name=vote_average]",t).val()}else if(t.is(".fivestar-combo-stars")){var p="combo"}else{var p="none"}if(t.is(".fivestar-smart-stars")){var p="smart"}if(v.size()){var h=v.attr("class").replace(/.*?fivestar-summary-([^ ]+).*/,"$1").replace(/-/g,"_")}else{var h="none"}i.mouseover(function(){g.drain();g.fill(this)}).mouseout(function(){g.drain();g.reset()});i.children().focus(function(){g.drain();g.fill(this.parentNode)}).blur(function(){g.drain();g.reset()}).end();l.mouseover(function(){g.drain();e(this).addClass("on")}).mouseout(function(){g.reset();e(this).removeClass("on")});l.children().focus(function(){g.drain();e(this.parentNode).addClass("on")}).blur(function(){g.reset();e(this.parentNode).removeClass("on")}).end();l.click(function(){u=0;g.reset();m=false;if(e("input.fivestar-path",t).size()&&v.is(".fivestar-feedback-enabled")){x(Drupal.settings.fivestar.feedbackDeletingVote)}e("select",t).val(0);c=p!="smart"?c:Drupal.settings.fivestar.titleAverage;e("label",t).html(c);if(t.is(".fivestar-smart-text")){t.removeClass("fivestar-user-text").addClass("fivestar-average-text");v[0].className=v[0].className.replace(/-user/,"-average");h=v.attr("class").replace(/.*?fivestar-summary-([^ ]+).*/,"$1").replace(/-/g,"_")}if(t.is(".fivestar-smart-stars")){t.removeClass("fivestar-user-stars").addClass("fivestar-average-stars")}e("input.fivestar-path",t).each(function(){var a=e("input.fivestar-token",t).val();e.ajax({type:"GET",data:{token:a},dataType:"xml",url:this.value+"/"+0,success:y})});return false});i.click(function(){u=e("select option",t).get(i.index(this)+l.size()+1).value;e("select",t).val(u);m=true;g.reset();if(e("input.fivestar-path",t).size()&&v.is(".fivestar-feedback-enabled")){x(Drupal.settings.fivestar.feedbackSavingVote)}if(t.is(".fivestar-smart-text")){t.removeClass("fivestar-average-text").addClass("fivestar-user-text");v[0].className=v[0].className.replace(/-average/,"-user");h=v.attr("class").replace(/.*?fivestar-summary-([^ ]+).*/,"$1").replace(/-/g,"_")}if(t.is(".fivestar-smart-stars")){t.removeClass("fivestar-average-stars").addClass("fivestar-user-stars")}e("input.fivestar-path",t).each(function(){var a=e("input.fivestar-token",t).val();e.ajax({type:"GET",data:{token:a},dataType:"xml",url:this.value+"/"+u,success:y})});return false});var g={fill:function(a){var s=i.index(a)+1;i.children("a").css("width","100%").end().filter(":lt("+s+")").addClass("hover").end();if(o&&!n){var r=e("select option",t)[s+l.size()].text;var f=e("select option",t)[s+l.size()].value;v.html(r!=s+1?r:"&nbsp;");e("label",t).html(d)}},drain:function(){i.filter(".on").removeClass("on").end().filter(".hover").removeClass("hover").end();if(o&&!n){var a=e("select option",t)[1].text;v.html(l.size()&&a!=0?a:"&nbsp");if(!m){e("label",t).html(c)}}},reset:function(){var a=u/100*i.size();var s=(a-Math.floor(a))*100;i.filter(":lt("+Math.floor(a)+")").addClass("on").end();if(s>0){i.eq(Math.floor(a)).addClass("on").children("a").css("width",s+"%").end().end()}if(o&&!n){v.html(f?f:"&nbsp;")}if(m){e("label",t).html(d)}else{e("label",t).html(c)}}};var x=function(e){n=1;v.html(e)};var y=function(t){var a={result:{count:e("result > count",t).text(),average:e("result > average",t).text(),summary:{average:e("summary average",t).text(),average_count:e("summary average_count",t).text(),user:e("summary user",t).text(),user_count:e("summary user_count",t).text(),combo:e("summary combo",t).text(),count:e("summary count",t).text()}},vote:{id:e("vote id",t).text(),tag:e("vote tag",t).text(),type:e("vote type",t).text(),value:e("vote value",t).text()},display:{stars:p,text:h}};if(window.fivestarResult){fivestarResult(a)}else{s(a)}f=a.result.summary[a.display.text];if(e(a.result.summary.average).is(".fivestar-feedback-enabled")){if(a.vote.value!=0){x(Drupal.settings.fivestar.feedbackVoteSaved)}else{x(Drupal.settings.fivestar.feedbackVoteDeleted)}n=setTimeout(function(){clearTimeout(n);n=0;v.html(a.result.summary[a.display.text])},2e3)}if(a.vote.value==0&&(p=="average"||p=="smart")){u=a.result.average;g.reset()}};g.reset();return r};var a=function(t){var a=e('<div class="fivestar-widget clear-block"></div>');var s=e("select option",t);var r=e("option",t).size()-1;var i=1;for(var l=1,v;v=s[l];l++){if(v.value=="0"){i=0;$div=e('<div class="cancel"><a href="#0" title="'+v.text+'">'+v.text+"</a></div>")}else{var n=(l+i-1)%2==0?"even":"odd";var f=l+i-1;var o=f==1?" star-first":"";var u=f==r+i-1?" star-last":"";$div=e('<div class="star star-'+f+" star-"+n+o+u+'"><a href="#'+v.value+'" title="'+v.text+'">'+v.text+"</a></div>")}a.append($div[0])}a.addClass("fivestar-widget-"+(r+i-1));e("select",t).after(a).css("display","none");return a};function s(t){e("div.fivestar-summary-"+t.vote.tag+"-"+t.vote.id).html(t.result.summary[t.display.text]);if(t.display.stars=="combo"){e("div.fivestar-form-"+t.vote.id).each(function(){var a=e(".fivestar-widget-static .star span",this);var s=t.result.average/100*a.size();var r=Math.floor(s);a.removeClass("on").addClass("off").css("width","auto");a.filter(":lt("+(r+1)+")").removeClass("off").addClass("on");a.eq(r).css("width",(s-r)*100+"%");var i=e(".fivestar-static-form-item .fivestar-summary",this);if(i.size()){var l=i.attr("class").replace(/.*?fivestar-summary-([^ ]+).*/,"$1").replace(/-/g,"_");i.html(t.result.summary[l])}})}}e.fn.fivestar=function(){var a=[];this.each(function(){var s=t(e(this));a.push(s)});return a};if(e.browser.msie==true){try{document.execCommand("BackgroundImageCache",false,true)}catch(r){}}Drupal.behaviors.fivestar=function(t){e("div.fivestar-form-item:not(.fivestar-processed)",t).addClass("fivestar-processed").fivestar();e("input.fivestar-submit",t).css("display","none")}})(jQuery);